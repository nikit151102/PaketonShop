<div class="product-card" [ngClass]="view" (click)="onProductClick($event)">
  <div class="top-bar">
    <div class="badge" [ngClass]="product.badgeType">{{ product.badge }}</div>
    <div class="actions">
      <span (click)="toggleFavorite($event)" [class.active]="product.favorite">‚ù§</span>
      <span *ngIf="showCompare" (click)="toggleCompare($event)" [class.active]="product.compare">‚áÑ</span>
    </div>
  </div>

  <div class="image-wrapper">
    <img [src]="(product.productImageLinks[0] || 'assets/images/no-image.png') | cleanStringLink"
      alt="{{ product.fullName }}" />

    <!-- <a class="quick-view-mobile">
    <svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#3fa937"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M21.9999 12C21.9999 16.714 21.9999 19.0711 20.5354 20.5355C19.1784 21.8926 17.055 21.9921 12.9999 21.9994M2.00049 11C2.00779 6.94493 2.10734 4.8215 3.46438 3.46447C4.92884 2 7.28587 2 11.9999 2C16.714 2 19.071 2 20.5354 3.46447C21.5092 4.43821 21.8355 5.80655 21.9448 8" stroke="#319e29" stroke-width="1.5" stroke-linecap="round"></path> <path d="M3 21L11 13M11 13H5M11 13V19" stroke="#319e29" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
</a> -->

    <!-- üîπ –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä -->
    <!-- <button class="quick-view" *ngIf="hovered" (click)="openQuickView()">üëÅ –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</button> -->
  </div>

  <div class="content">
    <h4>{{ product.fullName }}</h4>
    <span id="article">–∞—Ä—Ç–∏–∫—É–ª: {{product.article}}</span>
    <!-- üîπ –Ω–∞–ª–∏—á–∏–µ –∏ —É–ø–∞–∫–æ–≤–∫–∞ -->
    <div class="extra-info">
      <span class="stock" *ngIf="product.remains.length > 0">–í –Ω–∞–ª–∏—á–∏–∏: {{ product.remains[0].quantity }}
        —É–ø–∞–∫.</span>
      <span class="pack" *ngIf="product.packCount">–í —É–ø–∞–∫–æ–≤–∫–µ: {{ product.packCount }} —à—Ç.</span>
    </div>

    <div class="price-block">
      <span class="main-price">
        {{ getPrice(city$ | async) }} ‚ÇΩ
      </span>

      <span *ngIf="product.oldPrice" class="old-price">{{ product.oldPrice }} ‚ÇΩ</span>
      <span *ngIf="product.oldPrice" class="discount">
        -{{ ((1 - (getPrice(city$ | async)) / product.oldPrice) * 100) | number:'1.0-0' }}%
      </span>
    </div>

    <div class="total-price" *ngIf="quantitySelectorVisible && selectedQuantity>1">
      <strong>–û–±—â–∞—è —Å—É–º–º–∞:</strong> {{ getTotalPrice(city$ | async) }} ‚ÇΩ
    </div>

    <button class="add-cart" *ngIf="!inCart && !quantitySelectorVisible" (click)="toggleQuantitySelector()">–í
      –∫–æ—Ä–∑–∏–Ω—É</button>

    <div class="quantity-selector" *ngIf="quantitySelectorVisible">
      <div class="quantity-controls">
        <button class="quantity-btn" (click)="decreaseQty($event)">&#8722;</button> <!-- –ú–∏–Ω—É—Å -->
        <input class="input-quantity" type="number" [(ngModel)]="selectedQuantity" min="1" />
        <button class="quantity-btn" (click)="increaseQty($event)">&#43;</button> <!-- –ü–ª—é—Å -->
      </div>
    </div>

  </div>
</div>

<!-- –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–∞ -->
<div class="quick-view-modal" *ngIf="showQuickView">
  <div class="overlay" (click)="closeQuickView()"></div>

  <div class="modal-content">
    <button class="close" (click)="closeQuickView()">‚úñ</button>

    <div class="modal-body">
      <div class="product-left">
        <img [src]="product.productImageLinks[0] || 'assets/images/no-image.png'" alt="{{ product.fullName }}">
      </div>

      <div class="product-right">
        <h3>{{ product.fullName }}</h3>
        <span class="product-id">–ê—Ä—Ç–∏–∫—É–ª: {{ product.article }}</span>

        <p class="description">{{ product.description }}</p>

        <div class="price-block">
          <span class="current-price">{{ getPrice(city$ | async) | number:'1.1-1' }} ‚ÇΩ</span>
          <span *ngIf="product.oldPrice" class="old-price">{{ product.oldPrice }} ‚ÇΩ</span>
          <span *ngIf="product.oldPrice" class="discount">
            -{{ ((1 - (getPrice(city$ | async))/product.oldPrice)*100) | number:'1.0-0' }}%
          </span>
        </div>

        <div class="extra-info">
          <p *ngIf="product.remains.length > 0">–í –Ω–∞–ª–∏—á–∏–∏: {{ product.remains[0].quantity }} —É–ø–∞–∫.</p>
          <p>–£–ø–∞–∫–æ–≤–∫–∞: {{ product.packCount }} —à—Ç.</p>
          <p *ngIf="product.grossWeight">–í–µ—Å: {{ product.grossWeight }} –≥</p>
          <p *ngIf="product.height && product.width && product.depth">
            –†–∞–∑–º–µ—Ä: {{ product.width }}x{{ product.height }}x{{ product.depth }} –º–º
          </p>
        </div>

        <!-- –°–µ–ª–µ–∫—Ç–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ -->
        <div class="quantity-selector">
          <button class="quantity-btn" (click)="decreaseQty($event)">‚àí</button>
          <input type="number" [(ngModel)]="selectedQuantity" min="1" />
          <button class="quantity-btn" (click)="increaseQty($event)">+</button>
        </div>

        <div class="total-price">
          –û–±—â–∞—è —Å—É–º–º–∞: {{ getTotalPrice(city$ | async) }} ‚ÇΩ
        </div>

        <button class="add-cart" (click)="addToCart($event)">–í –∫–æ—Ä–∑–∏–Ω—É</button>
      </div>
    </div>
  </div>
</div>