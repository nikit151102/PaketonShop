<section class="modern-companies">
  <!-- Заголовок и управление -->
  <div class="companies-header">
    <div class="header-content">
      <div class="header-main">
        <p class="section-subtitle">Полное управление компаниями </p>
        <div class="info-tooltip">
          <svg width="16" height="16" viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
          </svg>
          <div class="tooltip-text">
            Здесь вы можете управлять всеми вашими компаниями.
            Добавляйте новые, редактируйте существующие или просматривайте детали.
          </div>
        </div>
      </div>
    </div>

    <button class="add-partner-btn" (click)="openAddPartnerForm()" title="Добавить новую компанию">
      <svg width="18" height="18" viewBox="0 0 24 24">
        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
      </svg>
      Добавить компанию
    </button>
  </div>

  <!-- Состояния загрузки -->
  <div class="loading-state" *ngIf="loading">
    <div class="loading-content">
      <div class="spinner-wrapper">
        <div class="spinner"></div>
      </div>
      <h3>Загружаем ваши компании...</h3>
      <p>Пожалуйста, подождите немного</p>
    </div>
  </div>

  <!-- Ошибка -->
  <div class="error-state" *ngIf="error && !loading">
    <div class="error-content">
      <div class="error-icon">
        <svg width="48" height="48" viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" />
        </svg>
      </div>
      <h3>Ошибка загрузки</h3>
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="retry()">
        <svg width="16" height="16" viewBox="0 0 24 24">
          <path
            d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
        </svg>
        Попробовать снова
      </button>
    </div>
  </div>

  <!-- Пустое состояние -->
  <div class="empty-state" *ngIf="!loading && !error && companies.length === 0">
    <div class="empty-content">
      <div class="empty-icon">
        <svg width="64" height="64" viewBox="0 0 24 24">
          <path
            d="M18 17H6v-2h12v2zm0-4H6v-2h12v2zm0-4H6V7h12v2zM3 22l1.5-1.5L6 22l1.5-1.5L9 22l1.5-1.5L12 22l1.5-1.5L15 22l1.5-1.5L18 22l1.5-1.5L21 22V2l-1.5 1.5L18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2 4.5 3.5 3 2v20z" />
        </svg>
      </div>
      <h3 class="empty-title">Нет добавленных компаний</h3>
      <p class="empty-description">Добавьте свою первую компанию для работы в качестве партнера</p>
      <div class="empty-tips">
        <div class="tip">
          <svg width="16" height="16" viewBox="0 0 24 24">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
          </svg>
          <span>Добавьте юридическое лицо для ведения бизнеса</span>
        </div>
      </div>
      <button class="empty-action-btn" (click)="openAddPartnerForm()">
        <svg width="16" height="16" viewBox="0 0 24 24">
          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
        </svg>
        Добавить первую компанию
      </button>
    </div>
  </div>

  <!-- Список компаний -->
  <div class="companies-list" *ngIf="!loading && !error && companies.length > 0">
    <!-- Информация и фильтры -->
    <div class="list-header">
      <div class="list-info">
        <div class="companies-count">
          <span class="count-number">{{ companies.length }}</span>
          <span class="count-text">компаний</span>
        </div>
        <div class="list-tips">
          <div class="list-tip">
            <svg width="14" height="14" viewBox="0 0 24 24">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
            </svg>
            <span>Кликните по карточке для просмотра деталей</span>
          </div>
        </div>
      </div>
      
      <div class="list-controls">
        <div class="scroll-controls">
          <button class="scroll-btn left" (click)="scrollLeft()" [disabled]="currentSlide === 0" title="Предыдущая карточка">
            <svg width="16" height="16" viewBox="0 0 24 24">
              <path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z" />
            </svg>
          </button>

          <div class="scroll-indicator">
            <div class="indicator-dot" *ngFor="let company of companies; let i = index" 
                 [class.active]="currentSlide === i"
                 [title]="'Компания ' + (i + 1) + ': ' + getCompanyShortName(company)">
            </div>
          </div>

          <button class="scroll-btn right" (click)="scrollRight()" 
                  [disabled]="currentSlide >= companies.length - 1"
                  title="Следующая карточка">
            <svg width="16" height="16" viewBox="0 0 24 24">
              <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Карточки -->
    <div class="cards-container" #cardsContainer (scroll)="onScroll()">
      <div class="company-card-modern" *ngFor="let company of companies; let i = index" 
           (click)="detailPartner(company)"
           [class.active]="activePartner?.id === company.id"
           [style.animation-delay]="i * 50 + 'ms'">
        
        <!-- Бейдж типа партнера -->
        <!-- <div class="partner-type-badge" 
             [class.legal]="isLegalEntity(company)"
             [class.individual]="isIndividualEntity(company)"
             [title]="getPartnerTypeTooltip(company)">
          {{ getPartnerTypeText(company) }}
        </div> -->

        <div class="card-header-modern">
          <div class="company-logo" [title]="'Логотип компании ' + getCompanyShortName(company)">
            <div class="logo-placeholder">
              {{ getCompanyLogoText(company) }}
            </div>
          </div>

          <div class="company-info-header">
            <h4 class="company-name" [title]="getCompanyFullName(company)">
              {{ getCompanyShortName(company) }}
            </h4>
            <p class="company-fullname" [title]="getCompanyFullName(company)">
              {{ getCompanyFullName(company) }}
            </p>
          </div>

          <div class="card-actions">
            <button class="action-btn edit" 
                    (click)="openEditPartnerForm(company, $event)" 
                    title="Редактировать компанию">
              <svg width="14" height="14" viewBox="0 0 24 24">
                <path
                  d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
              </svg>
            </button>
            <button class="action-btn delete" 
                    (click)="deletePartner(company, $event)" 
                    title="Удалить компанию">
              <svg width="14" height="14" viewBox="0 0 24 24">
                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
              </svg>
            </button>
          </div>
        </div>

        <div class="card-body-modern">
          <!-- Основная информация -->
          <div class="company-details">
            <div class="detail-item" title="Идентификационный номер налогоплательщика">
              <svg class="detail-icon" width="14" height="14" viewBox="0 0 24 24">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2z" />
              </svg>
              <div class="detail-content">
                <span class="detail-label">ИНН</span>
                <span class="detail-value">{{ getCompanyINN(company) }}</span>
              </div>
            </div>

            <div class="detail-item" title="Основной государственный регистрационный номер">
              <svg class="detail-icon" width="14" height="14" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" />
              </svg>
              <div class="detail-content">
                <span class="detail-label">ОГРН</span>
                <span class="detail-value">{{ getCompanyOGRN(company) }}</span>
              </div>
            </div>

            <div class="detail-item" title="Контактный телефон компании">
              <svg class="detail-icon" width="14" height="14" viewBox="0 0 24 24">
                <path
                  d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z" />
              </svg>
              <div class="detail-content">
                <span class="detail-label">Телефон</span>
                <span class="detail-value">{{ getCompanyPhone(company) }}</span>
              </div>
            </div>

            <div class="detail-item" title="Основная сфера деятельности компании">
              <svg class="detail-icon" width="14" height="14" viewBox="0 0 24 24">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" />
                <circle cx="12" cy="9" r="2.5"/>
              </svg>
              <div class="detail-content">
                <span class="detail-label">Сфера</span>
                <span class="detail-value">{{ getCompanyWorkDirection(company) }}</span>
              </div>
            </div>
          </div>

          <!-- Быстрые действия -->
          <div class="quick-actions">
            <button class="quick-action-btn details" 
                    (click)="detailPartner(company); $event.stopPropagation()"
                    title="Просмотреть полную информацию о компании">
              <svg width="14" height="14" viewBox="0 0 24 24">
                <path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/>
              </svg>
              Подробнее
            </button>
          </div>
        </div>

        <!-- Статус обновления -->
        <div class="card-footer-modern">
          <div class="updated-info">
            <svg width="12" height="12" viewBox="0 0 24 24">
              <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm5 13h-6v-2h6v2zm0-4h-6V9h6v2z"/>
            </svg>
            <span class="updated-at">
              {{ getUpdatedDate(company) }}
            </span>
          </div>
          <div class="id-hint" title="ID компании в системе">
            ID: {{ company.id ? company.id.substring(0, 8) + '...' : 'Не указан' }}
          </div>
        </div>
      </div>
    </div>

    <!-- Подсказки для скролла -->
    <div class="scroll-hint" *ngIf="companies.length > 3">
      <svg width="16" height="16" viewBox="0 0 24 24">
        <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
      </svg>
      <span>Прокрутите для просмотра всех компаний</span>
    </div>
  </div>
</section>

<!-- Форма партнера -->
<app-partner-form *ngIf="showPartnerForm" [partner]="editingPartner" (close)="closePartnerForm()"
  (saved)="handlePartnerSaved($event)">
</app-partner-form>

<!-- Детали партнера -->
<app-partner-detail *ngIf="activePartner" [partner]="activePartner" (close)="closePartnerDetail()"
  (edit)="openEditPartnerForm(activePartner)">
</app-partner-detail>