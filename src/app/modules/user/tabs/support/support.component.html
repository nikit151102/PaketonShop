<div class="support-page">
  <!-- Заголовок -->
  <div class="support-header">
    <div class="header-content">
      <div class="header-title">
        <svg class="header-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 12h-2v-2h2v2zm0-4h-2V6h2v4z"/>
        </svg>
        <div>
          <h1 *ngIf="!selectedTicket && !showCreateTicket">Техническая поддержка</h1>
          <h1 *ngIf="selectedTicket">Обращение #{{ selectedTicket.id }}</h1>
          <p class="header-subtitle">Мы всегда готовы помочь вам</p>
        </div>
      </div>
      
      <div class="header-stats" *ngIf="!selectedTicket && !showCreateTicket">
        <div class="stat-item">
          <span class="stat-count">{{ getUnreadCount() }}</span>
          <span class="stat-label">непрочитанных</span>
        </div>
        <button class="new-ticket-btn" (click)="openCreateTicket()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
          </svg>
          Новое обращение
        </button>
      </div>
      
      <div class="header-actions" *ngIf="selectedTicket || showCreateTicket">
        <button class="back-btn" (click)="goBack()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
          </svg>
          Назад к списку
        </button>
      </div>
    </div>
  </div>

  <!-- Основной контент -->
  <div class="support-content">
    <!-- Список обращений (показывается когда нет выбранного тикета и не открыта форма создания) -->
    <div *ngIf="!selectedTicket && !showCreateTicket" class="tickets-list-container">
      <div class="list-header">
        <h2>Мои обращения</h2>
        <div class="list-stats">
          <span class="stats-count">{{ tickets.length }}</span>
          <span class="stats-label">{{ tickets.length | i18nPlural: {
            '=0': 'обращений',
            '=1': 'обращение',
            '=2': 'обращения',
            '=3': 'обращения',
            '=4': 'обращения',
            'other': 'обращений'
          } }}</span>
        </div>
      </div>
      
      <div class="list-content">
        <!-- Кнопка создания нового обращения -->
        <div class="create-card" (click)="openCreateTicket()">
          <div class="create-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
          </div>
          <div class="create-content">
            <h3>Создать новое обращение</h3>
            <p>Нажмите чтобы создать новый запрос в поддержку</p>
          </div>
        </div>
        
        <!-- Список обращений -->
        <div class="tickets-grid">
          <div 
            *ngFor="let ticket of tickets"
            class="ticket-card"
            [class.unread]="ticket.unreadCount > 0"
            [class.closed]="ticket.status === 'closed' || ticket.status === 'closed_by_client'"
            (click)="selectTicket(ticket)"
          >
            <div class="ticket-card-header">
              <div class="ticket-category">
                <span class="category-icon">{{ getCategoryIcon(ticket.category) }}</span>
                <span class="category-name">{{ ticket.category }}</span>
              </div>
              <div class="ticket-status" [ngClass]="'status-' + ticket.status">
                {{ getStatusText(ticket.status) }}
              </div>
            </div>
            
            <div class="ticket-card-body">
              <h4 class="ticket-subject">{{ ticket.subject }}</h4>
              <p class="ticket-preview">{{ getMessagePreview(ticket.lastMessage) }}</p>
              
              <div class="ticket-meta">
                <span class="ticket-date">{{ formatDate(ticket.lastMessageTime) }}</span>
                <div class="ticket-badges">
                  <span class="unread-badge" *ngIf="ticket.unreadCount > 0">
                    {{ ticket.unreadCount }} непрочитанных
                  </span>
                  <span class="rating-badge" *ngIf="ticket.rating">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                    </svg>
                    {{ ticket.rating }}
                  </span>
                </div>
              </div>
            </div>
            
            <!-- <div class="ticket-card-footer" *ngIf="ticket.agent">
              <img [src]="ticket.agent.avatar" [alt]="ticket.agent.name" class="agent-avatar" />
              <span class="agent-name">{{ ticket.agent.name }}</span>
            </div> -->
          </div>
        </div>
        
        <!-- Пустой список -->
        <div *ngIf="tickets.length === 0" class="empty-state">
          <div class="empty-illustration">
            <svg viewBox="0 0 400 300" fill="none">
              <path d="M200 100C200 44.7715 244.772 0 300 0H350C372.091 0 390 17.9086 390 40V260C390 282.091 372.091 300 350 300H50C27.9086 300 10 282.091 10 260V40C10 17.9086 27.9086 0 50 0H100C155.228 0 200 44.7715 200 100Z" fill="#F0F4FF"/>
              <circle cx="200" cy="150" r="60" fill="#667eea"/>
              <path d="M180 140L190 150L220 130" stroke="white" stroke-width="10" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <h3>У вас пока нет обращений</h3>
          <p>Создайте первое обращение, и наша поддержка поможет вам</p>
          <button class="create-btn" (click)="openCreateTicket()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
            Создать обращение
          </button>
        </div>
      </div>
    </div>

    <!-- Чат обращения (показывается при выборе тикета) -->
    <div *ngIf="selectedTicket && !showCreateTicket" class="ticket-chat-container">
      <app-ticket-chat
        [ticket]="selectedTicket"
        (ticketUpdated)="handleTicketUpdated($event)"
      ></app-ticket-chat>
    </div>

    <!-- Форма создания обращения -->
    <div *ngIf="showCreateTicket" class="create-ticket-container">
      <app-create-ticket
        (ticketCreated)="handleTicketCreated($event)"
        (cancel)="showCreateTicket = false"
      ></app-create-ticket>
    </div>
  </div>
</div>