<div class="addresses-root">
  <header class="header">
    <div>
      <h1>–ú–æ–∏ –∞–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</h1>
      <p class="muted">–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∞–¥—Ä–µ—Å–∞, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –≤—ã–±–∏—Ä–∞—Ç—å –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞</p>
    </div>
    <div class="actions">
      <input class="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É..." [(ngModel)]="filter" />
      <button class="btn primary" (click)="openAdd()">+ –î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å</button>
    </div>
  </header>

  <main>
    <div *ngIf="loading" class="center">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div *ngIf="error" class="error">{{ error }}</div>

    <div *ngIf="!loading && (filteredAddresses().length === 0)" class="empty">
      –ê–¥—Ä–µ—Å–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π.
    </div>

    <div class="grid">
      <article class="card" *ngFor="let addr of filteredAddresses()">
        <div class="card-top">
          <div class="title">{{ addr.city }}, {{ addr.street }} {{ addr.house }}{{ addr.housing ? '/' + addr.housing : '' }}</div>
          <div class="small-muted">–ò–Ω–¥–µ–∫—Å: {{ addr.postIndex || '‚Äî' }}</div>
        </div>

        <div class="card-body">
          <div class="line"><strong>–û—Ñ–∏—Å/–ö–≤:</strong> {{ addr.office || '‚Äî' }}</div>
          <div class="line"><strong>–≠—Ç–∞–∂:</strong> {{ addr.floorNumber || '‚Äî' }}</div>
        </div>

        <div class="card-actions">
          <button class="link" (click)="openEdit(addr)" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
          <button class="link danger" (click)="confirmDelete(addr)" title="–£–¥–∞–ª–∏—Ç—å">üóë –£–¥–∞–ª–∏—Ç—å</button>
        </div>
      </article>
    </div>
  </main>

  <!-- Modal: Add / Edit -->
  <div class="modal-backdrop" *ngIf="isModalOpen">
    <div class="modal">
      <h2>{{ isEditing ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å' : '–ù–æ–≤—ã–π –∞–¥—Ä–µ—Å' }}</h2>

      <form [formGroup]="addressForm" (ngSubmit)="save()">
        <div class="form-row">
          <label>–ì–æ—Ä–æ–¥ *</label>
          <input formControlName="city" />
          <div class="form-error" *ngIf="addressForm.get('city')?.touched && addressForm.get('city')?.invalid">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</div>
        </div>

        <div class="form-row">
          <label>–£–ª–∏—Ü–∞ *</label>
          <input formControlName="street" />
          <div class="form-error" *ngIf="addressForm.get('street')?.touched && addressForm.get('street')?.invalid">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</div>
        </div>

        <div class="form-grid">
          <div class="form-row">
            <label>–î–æ–º *</label>
            <input formControlName="house" />
          </div>
          <div class="form-row">
            <label>–ö–æ—Ä–ø—É—Å</label>
            <input formControlName="housing" />
          </div>
          <div class="form-row">
            <label>–≠—Ç–∞–∂</label>
            <input formControlName="floorNumber" />
          </div>
          <div class="form-row">
            <label>–û—Ñ–∏—Å / –ö–≤</label>
            <input formControlName="office" />
          </div>
        </div>

        <div class="form-row">
          <label>–ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å</label>
          <input formControlName="postIndex" />
        </div>

        <div class="form-row two">
          <div>
            <label>–®–∏—Ä–æ—Ç–∞</label>
            <input formControlName="latitude" type="number" step="any" />
          </div>
          <div>
            <label>–î–æ–ª–≥–æ—Ç–∞</label>
            <input formControlName="longitude" type="number" step="any" />
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn" (click)="cancelModal()">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn primary">{{ isEditing ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–°–æ–∑–¥–∞—Ç—å' }}</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete confirm -->
  <div class="modal-backdrop" *ngIf="isDeleteConfirmOpen">
    <div class="modal small">
      <h3>–£–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å?</h3>
      <p>–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å: <strong>{{ editingAddress?.city }}, {{ editingAddress?.street }} {{ editingAddress?.house }}</strong>?</p>
      <div class="modal-actions">
        <button class="btn" (click)="isDeleteConfirmOpen = false">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn danger" (click)="delete()">–£–¥–∞–ª–∏—Ç—å</button>
      </div>
    </div>
  </div>
</div>
