<form class="modern-order-form" >
  <!-- –ù–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º -->
  <div class="form-header-section">
    <div class="header-content">
      <h1 class="form-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>
      <p class="form-subtitle">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–∫—É–ø–∫–∏</p>
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ñ–æ—Ä–º—ã -->
  <div class="form-content">
    <!-- –ë–ª–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –¥–∏–∑–∞–π–Ω–µ -->
    <div class="user-section modern-section">
      <div class="section-header">
        <div class="section-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
          </svg>
        </div>
        <div>
          <h2 class="section-title">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
          <p class="section-description">–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è —Å–≤—è–∑–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞</p>
        </div>
      </div>

      <div class="user-content">
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤ —Å—Ç–µ–∫–µ -->
        <div *ngIf="!isEditing && currentUserData" class="user-stack-card">
          <div class="user-stack-avatar">
            <div class="avatar-glow">
              <div class="avatar-circle">
                {{ getInitials() }}
              </div>
            </div>
          </div>

          <div class="user-stack-details">
            <div class="user-main-info">
              <h3 class="user-name">{{ currentUserData.firstName || '' }} {{ currentUserData.lastName || '' }}</h3>
              <!-- <div class="user-badges">
                <span class="badge primary">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                    <path
                      d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                  </svg>
                  –§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ
                </span>
              </div> -->
            </div>

            <div class="user-contact-grid">
              <div class="contact-item">
                <div class="contact-icon">üì±</div>
                <div class="contact-info">
                  <div class="contact-label">–¢–µ–ª–µ—Ñ–æ–Ω</div>
                  <div class="contact-value">{{ currentUserData.phoneNumber || '–ù–µ —É–∫–∞–∑–∞–Ω' }}</div>
                </div>
              </div>

              <div class="contact-item">
                <div class="contact-icon">‚úâÔ∏è</div>
                <div class="contact-info">
                  <div class="contact-label">Email</div>
                  <div class="contact-value">{{ currentUserData.email || '–ù–µ —É–∫–∞–∑–∞–Ω' }}</div>
                </div>
              </div>
            </div>
          </div>

          <button class="edit-stack-btn" (click)="startEditing()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
            </svg>
            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
          </button>
        </div>

        <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö -->
        <div *ngIf="isEditing || !currentUserData" class="edit-card-stack">
          <div class="edit-card">
            <div class="card-header">
              <h3>–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
              <button *ngIf="currentUserData" class="card-close" (click)="cancelEditing()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path
                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                </svg>
              </button>
            </div>

            <div class="card-body">
              <div class="input-grid">
                <div class="input-group">
                  <label>–ò–º—è *</label>
                  <input type="text" [(ngModel)]="formData.firstName" name="firstName" placeholder="–í–∞—à–µ –∏–º—è"
                    class="modern-input">
                </div>

                <div class="input-group">
                  <label>–§–∞–º–∏–ª–∏—è *</label>
                  <input type="text" [(ngModel)]="formData.lastName" name="lastName" placeholder="–í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è"
                    class="modern-input">
                </div>
              </div>

              <div class="input-group">
                <label>–û—Ç—á–µ—Å—Ç–≤–æ</label>
                <input type="text" [(ngModel)]="formData.middleName" name="middleName" placeholder="–í–∞—à–µ –æ—Ç—á–µ—Å—Ç–≤–æ"
                  class="modern-input">
              </div>

              <div class="input-grid">
                <div class="input-group">
                  <label>–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                  <div class="phone-group">
                    <span class="phone-prefix">+7</span>
                    <input type="tel" [(ngModel)]="formData.phone" name="phone" placeholder="(999) 123-45-67"
                      class="modern-input">
                  </div>
                </div>

                <div class="input-group">
                  <label>Email *</label>
                  <input type="email" [(ngModel)]="formData.email" name="email" placeholder="your@email.com"
                    class="modern-input">
                </div>
              </div>

              <div class="card-actions">
                <button class="btn-primary" (click)="saveChanges()">
                  –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
                <button *ngIf="currentUserData" class="btn-secondary" (click)="cancelEditing()">
                  –û—Ç–º–µ–Ω–∏—Ç—å
                </button>
              </div>
            </div>
          </div>

          <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ -->
          <div class="settings-card">
            <div class="card-header">
              <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            </div>

            <div class="card-body">
              <div class="textarea-group">
                <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</label>
                <textarea [(ngModel)]="formData.info" name="info" placeholder="–í–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏..."
                  class="modern-textarea"></textarea>
              </div>

              <div class="switch-group">
                <label class="switch">
                  <input type="checkbox" [(ngModel)]="formData.needConsult" name="needConsult" class="switch-input">
                  <span class="switch-slider"></span>
                  <div class="switch-content">
                    <div class="switch-title">–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</div>
                    <div class="switch-description">–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π</div>
                  </div>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- –¢–∏–ø –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –¥–∏–∑–∞–π–Ω–µ -->
    <div class="type-section modern-section">
      <div class="section-header">
        <div class="section-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
          </svg>
        </div>
        <div>
          <h2 class="section-title">–¢–∏–ø –ø–æ–∫—É–ø–∞—Ç–µ–ª—è</h2>
          <p class="section-description">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –ø–æ–∫—É–ø–∫–∏</p>
        </div>
      </div>

      <div class="type-grid">
        <div class="type-card" [class.active]="formData.personType === 'fiz'" (click)="formData.personType = 'fiz'">
          <div class="type-card-header">
            <div class="type-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
              </svg>
            </div>
            <div class="type-indicator" *ngIf="formData.personType === 'fiz'">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
              </svg>
            </div>
          </div>

          <div class="type-card-body">
            <h3 class="type-title">–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ</h3>
            <p class="type-description">–î–ª—è —á–∞—Å—Ç–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫ –∏ –ª–∏—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</p>
          </div>

          <div class="type-card-footer">
            <!-- <span class="type-tag">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è</span> -->
          </div>
        </div>

        <div class="type-card" [class.active]="formData.personType === 'jur'" (click)="formData.personType = 'jur'">
          <div class="type-card-header">
            <div class="type-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M18 17H6v-2h12v2zm0-4H6v-2h12v2zm0-4H6V7h12v2zM3 22l1.5-1.5L6 22l1.5-1.5L9 22l1.5-1.5L12 22l1.5-1.5L15 22l1.5-1.5L18 22l1.5-1.5L21 22V2l-1.5 1.5L18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2 4.5 3.5 3 2v20z" />
              </svg>
            </div>
            <div class="type-indicator" *ngIf="formData.personType === 'jur'">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
              </svg>
            </div>
          </div>

          <div class="type-card-body">
            <h3 class="type-title">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ</h3>
            <p class="type-description">–î–ª—è –±–∏–∑–Ω–µ—Å–∞, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –∏ –æ–ø—Ç–æ–≤—ã—Ö –∑–∞–∫—É–ø–æ–∫</p>
          </div>

          <div class="type-card-footer">
            <!-- <span class="type-tag">–° –ù–î–°</span> -->
          </div>
        </div>
      </div>

      <!-- –°–µ–∫—Ü–∏—è –∫–æ–º–ø–∞–Ω–∏–π (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —é—Ä.–ª–∏—Ü–∞) -->
<app-company-selector
  *ngIf="formData.personType === 'jur'"
  [selectedCompanyId]="selectedCompanyId"
  (selectedCompanyChange)="onCompanySelected($event)"
  (companyAdded)="onCompanyAdded()"
  (companyEdited)="onCompanyEdited($event)"
  (companyDeleted)="onCompanyDeleted($event)">
</app-company-selector>

    </div>

    <!-- –°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –¥–∏–∑–∞–π–Ω–µ -->
    <div class="delivery-section modern-section">
      <div class="section-header">
        <div class="section-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4z" />
          </svg>
        </div>
        <div>
          <h2 class="section-title">–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</h2>
          <p class="section-description">–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞</p>
        </div>
      </div>

      <div class="delivery-grid">
        <div class="delivery-card" [class.active]="formData.delivery === 'pickup'" (click)="selectDelivery('pickup')">
          <div class="delivery-card-header">
            <div class="delivery-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M18 1.01L8 1c-1.1 0-2 .9-2 2v3h2V5h10v14H8v-1H6v3c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM10 15h2V8H5v2h3.59L3 15.59 4.41 17 10 11.41V15z" />
              </svg>
            </div>
            <div class="delivery-badge free">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</div>
          </div>

          <div class="delivery-card-body">
            <h3 class="delivery-title">–°–∞–º–æ–≤—ã–≤–æ–∑</h3>
            <p class="delivery-description">–ó–∞–±–µ—Ä–∏—Ç–µ –∑–∞–∫–∞–∑ –∏–∑ –Ω–∞—à–µ–≥–æ –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏</p>
          </div>

          <div class="delivery-card-footer">
            <div class="delivery-details">
              <span class="delivery-detail">1-2 –¥–Ω—è</span>
              <span class="delivery-detail">10:00 - 20:00</span>
            </div>
          </div>
        </div>

        <div class="delivery-card" [class.active]="formData.delivery === 'transport'"
          (click)="selectDelivery('transport')">
          <div class="delivery-card-header">
            <div class="delivery-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4z" />
              </svg>
            </div>
            <div class="delivery-badge">–æ—Ç 500 ‚ÇΩ</div>
          </div>

          <div class="delivery-card-body">
            <h3 class="delivery-title">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è</h3>
            <p class="delivery-description">–î–æ—Å—Ç–∞–≤–∫–∞ –∫—É—Ä—å–µ—Ä—Å–∫–æ–π —Å–ª—É–∂–±–æ–π –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏</p>
          </div>

          <div class="delivery-card-footer">
            <div class="delivery-details">
              <span class="delivery-detail">3-7 –¥–Ω–µ–π</span>
              <span class="delivery-detail">–†–∞—Å—á–µ—Ç–Ω–∞—è</span>
            </div>
          </div>
        </div>

        <div class="delivery-card" [class.active]="formData.delivery === 'city'" (click)="selectDelivery('city')">
          <div class="delivery-card-header">
            <div class="delivery-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zM7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 2.88-2.88 7.19-5 9.88C9.92 16.21 7 11.85 7 9z" />
                <circle cx="12" cy="9" r="2.5" />
              </svg>
            </div>
            <div class="delivery-badge">500 ‚ÇΩ</div>
          </div>

          <div class="delivery-card-body">
            <h3 class="delivery-title">–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É</h3>
            <p class="delivery-description">–ö—É—Ä—å–µ—Ä—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –∞–¥—Ä–µ—Å—É –≤ –≤–∞—à–µ–º –≥–æ—Ä–æ–¥–µ</p>
          </div>

          <div class="delivery-card-footer">
            <div class="delivery-details">
              <span class="delivery-detail">–í —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è</span>
              <span class="delivery-detail">9:00 - 21:00</span>
            </div>
          </div>
        </div>
      </div>

      <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–æ—Å—Ç–∞–≤–∫–∏ -->
      <div class="delivery-details-section">
        <app-pickup-delivery *ngIf="formData.delivery === 'pickup'" (storeSelected)="onDeliveryDataChange('store', $event)">
        </app-pickup-delivery>

        <app-transport-delivery *ngIf="formData.delivery === 'transport'" (addressSelected)="onDeliveryDataChange('transport', $event)">
        </app-transport-delivery>

        <app-city-delivery *ngIf="formData.delivery === 'city'" (addressSelected)="onDeliveryDataChange('city', $event)">
        </app-city-delivery>
      </div>
    </div>
  </div>

  <!-- –§—É—Ç–µ—Ä —Ñ–æ—Ä–º—ã —Å –∫–Ω–æ–ø–∫–æ–π –∏ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ–º -->
  <div class="form-footer-section">
    <div class="agreement-section">
      <label class="agreement-toggle">
        <input type="checkbox" [(ngModel)]="formData.agreement" name="agreement" class="agreement-input">
        <span class="agreement-checkbox"></span>
        <span class="agreement-text">
          –Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å
          <a href="#" class="agreement-link">—É—Å–ª–æ–≤–∏—è–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</a>
          –∏
          <a href="#" class="agreement-link">–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ–º</a>
        </span>
      </label>
    </div>

    <div class="submit-section">
      <div class="order-summary">
        <div class="summary-item">
          <span>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</span>
          <span class="summary-total">14 890 ‚ÇΩ</span>
        </div>
        <div class="summary-note">–í–∫–ª—é—á–∞—è –ù–î–°</div>
      </div>

      <button type="submit" class="submit-button" [disabled]="!formData.agreement || isSubmitting"
        [class.loading]="isSubmitting">
        <span class="button-content">
          <svg class="button-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" *ngIf="!isSubmitting">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
          </svg>
          <svg class="button-spinner" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"
            *ngIf="isSubmitting">
            <path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm0 18a8 8 0 1 1 8-8 8 8 0 0 1-8 8z" opacity="0.3" />
            <path d="M12 2a10 10 0 0 0 0 20 10 10 0 0 0 0-20zm0 18a8 8 0 1 1 8-8 8 8 0 0 1-8 8z" />
          </svg>
          <span class="button-text">
            {{ isSubmitting ? '–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–∞...' : '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ' }}
          </span>
        </span>
      </button>

    </div>
  </div>
</form>